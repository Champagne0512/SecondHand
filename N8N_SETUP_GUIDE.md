# 校园二手交易平台AI客服助手 - n8n配置指南

## 🎯 概述

这个n8n工作流将您的校园二手交易平台AI助手升级为专业的智能客服，能够：
- 🔍 基于实际商品数据库提供准确信息
- 💰 进行价格分析和市场对比
- 🛡️ 提供专业的交易安全指导
- 🤖 集成DeepSeek AI进行智能对话
- 📊 实时查询商品、用户、交易数据

## 📋 前置要求

1. **n8n环境**
   - n8n版本：1.0+ 
   - 运行环境：Docker/本地/云端
   - 端口：5678（默认）

2. **API密钥**
   - DeepSeek API密钥：`sk-98e0a077fdbe422585855c3b10f03986`
   - Supabase数据库连接信息（已内置）

3. **网络配置**
   - Webhook地址：`http://localhost:5678/webhook/website-assistant`
   - 确保n8n服务可从您的网站访问

## 🔧 安装配置步骤

### 第一步：导入工作流

1. 打开n8n界面（`http://localhost:5678`）
2. 点击左侧菜单栏的"Workflows"
3. 点击"Import"按钮
4. 选择`campus-marketplace-ai-assistant-workflow.json`文件
5. 点击"Import"确认导入

### 第二步：配置DeepSeek API

1. 在n8n界面中，点击左侧的"Credentials"
2. 点击"Add Credential"按钮
3. 选择"OpenAI API"类型
4. 填写配置信息：
   ```
   Name: DeepSeek API
   API Key: sk-98e0a077fdbe422585855c3b10f03986
   Base URL: https://api.deepseek.com/v1
   ```
5. 点击"Save"保存

### 第三步：验证工作流

1. 在工作流编辑界面，点击"Activate"激活工作流
2. 点击"Test"按钮测试运行
3. 检查是否有错误提示

## 🧪 测试工作流

### 使用curl测试

```bash
curl -X POST http://localhost:5678/webhook/website-assistant \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"message\": \"我想买一台二手iPhone，大概多少钱？\",\n    \"userId\": \"test-user-123\",\n    \"sessionId\": \"test-session-456\"\n  }'
```

### 预期响应

```json
{\n  \"response\": \"📊 价格分析报告\\n\\n为您找到5件相关商品...\",\n  \"type\": \"price_analysis\",\n  \"confidence\": 0.95,\n  \"timestamp\": \"2024-01-15T10:30:00Z\"\n}
```

## 🔗 前端集成配置

### 更新AI助手组件

您的Vue组件已经配置好，主要修改了`getBackupResponse`函数，使其更适合校园二手交易场景。

### Webhook URL配置

在`FloatingAIAssistant.vue`中，确保webhook地址正确：

```typescript
const n8nWebhookUrl = 'http://localhost:5678/webhook/website-assistant'
```

如果n8n部署在不同地址，请相应修改。

## 🎯 功能特性

### 1. 智能意图识别
- **商品价格咨询**：识别价格相关关键词
- **商品搜索请求**：理解搜索意图
- **交易安全咨询**：安全相关问题
- **用户账户问题**：登录、注册等
- **投诉建议**：问题反馈

### 2. 专业回复生成
- **价格分析**：基于真实商品数据
- **搜索推荐**：智能筛选和排序
- **安全指导**：详细的交易安全建议
- **通用对话**：DeepSeek AI智能回复

### 3. 数据驱动回复
- 实时查询Supabase数据库
- 基于实际商品信息回复
- 市场价格统计分析
- 用户行为数据参考

## 📊 预期效果

### 用户体验提升
- ✅ 回答更准确、专业
- ✅ 基于真实数据，可信度高
- ✅ 回复格式清晰，易于理解
- ✅ 响应速度快，实时性好

### 客服效率提升
- ✅ 24/7全天候服务
- ✅ 同时处理多个用户咨询
- ✅ 减少人工客服工作量
- ✅ 标准化专业服务

## 🔍 监控和优化

### 监控指标
- 响应时间：< 2秒
- 成功率：> 95%
- 用户满意度：通过反馈收集
- 意图识别准确率：> 85%

### 优化建议
1. **定期更新商品数据**：确保数据新鲜度
2. **优化意图识别**：根据用户反馈调整
3. **丰富回复模板**：增加更多场景覆盖
4. **个性化推荐**：基于用户历史行为

## 🚨 常见问题解决

### 1. n8n连接失败
```bash
# 检查n8n服务状态
docker ps | grep n8n

# 查看日志
docker logs n8n-container
```

### 2. DeepSeek API调用失败
- 检查API密钥是否正确
- 确认账户余额充足
- 验证网络连接

### 3. 数据库查询失败
- 检查Supabase连接信息
- 验证数据库表结构
- 确认RLS策略配置

### 4. Webhook响应超时
- 增加n8n执行超时时间
- 优化数据库查询性能
- 检查网络延迟

## 📞 技术支持

如遇到配置问题，请检查：
1. 所有API密钥是否正确配置
2. 网络连接是否正常
3. n8n服务是否运行正常
4. 数据库连接是否稳定

## 🔄 更新维护

### 定期更新内容
- 商品分类和品牌数据
- 回复模板和提示词
- 安全建议和最佳实践
- 用户常见问题FAQ

### 版本管理
- 工作流版本：1.0.0
- 最后更新：2024-01-15
- 下次更新：根据用户反馈优化

---

**恭喜！** 🎉 完成以上配置后，您的校园二手交易平台就拥有了一个专业的AI客服助手，能够为用户提供准确、专业、个性化的服务体验！